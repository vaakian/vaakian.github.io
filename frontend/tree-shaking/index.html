<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.91.2">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="VAANOTE">
<meta property="og:url" content="https://note.vaakian.com/frontend/tree-shaking/">
<link rel=canonical href=https://note.vaakian.com/frontend/tree-shaking/><link rel=alternate type=application/atom+xml href=https://note.vaakian.com/index.xml title="Study Notes">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/note.vaakian.com\/"},"articleSection":"frontend","name":"å…³äº tree-shaking","headline":"å…³äº tree-shaking","description":"æœ€è¿‘å¯¹Tree-shakingåšäº†ä¸å°‘çš„äº†è§£å’Œç ”ç©¶ï¼Œè¿™é‡Œåšä¸€äº›ä¸ªäººæ€»ç»“ï¼Œæ–¹ä¾¿ä»¥åé—å¿˜æ—¶è¿›è¡Œå¤ä¹ ã€‚\nä»€ä¹ˆæ˜¯Tree-shaking æœ¯è¯­è§£é‡Š Tree-shakingæ˜¯ä¸€ç§ç”¨äºæ¶ˆé™¤JavaScriptä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç (dead-code)çš„ä¼˜åŒ–æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§åŸºäºES6æ¨¡å—çš„é™æ€ä»£ç åˆ†ææŠ€æœ¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±è¿›è¡Œä»£ç çš„æ¶ˆé™¤ï¼Œä»è€Œå‡å°‘ä»£ç ä½“ç§¯ã€‚\né€šä¿—è§£é‡Š ä»è‹±æ–‡å­—é¢æ„æ€â€œæ‘‡æ ‘â€ä¸Šæ¥çœ‹ï¼Œå°±æ˜¯æŠŠä¸€æ£µæ ‘ä¸Šçš„ä¸éœ€è¦çš„å¶å­æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„å¶å­ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒTree-shakingå°±æ˜¯æŒ‡åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼ŒæŠŠä¸éœ€è¦çš„ä»£ç æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„ä»£ç ã€‚\nTree-shakingçš„åŸç† æ—©æœŸå¤§éƒ¨åˆ†nodeåŒ…éƒ½æ˜¯commonJSæ ¼å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡requireæ¥å¼•å…¥ã€‚å®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šå› ä¸ºå®ƒçš„åŠ¨æ€æ€§ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¾ˆéš¾æ‰¾åˆ°ä¸ç”¨çš„ä»£ç è¿›è¡Œtree-shakingã€‚\nåˆ°äº†ESModuleæ—¶ä»£ï¼ŒTree-shakingå˜å¾—å®¹æ˜“èµ·æ¥ã€‚\næœ€æ—©çš„Tree-shakingæ˜¯ç”±Rollup.jsæå‡ºçš„ï¼Œå®ƒçš„å°±æ˜¯åˆ©ç”¨ESMçš„é™æ€ä¼˜åŠ¿ï¼Œé€šè¿‡é™æ€åˆ†ææ‰¾å‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ç„¶åæŠŠæ²¡æœ‰ç”¨åˆ°çš„ä»£ç å»æ‰ã€‚\né‚£ä¹ˆæ—©æœŸæ²¡æœ‰ESMï¼Œtree-shakingæŠ€æœ¯çš„æ—¶å€™ï¼Œæ€ä¹ˆåšåˆ°æŒ‰éœ€æ‰“åŒ…ï¼Ÿ åœ¨Tree-shakingæ²¡æœ‰å…´èµ·çš„æ—¶å€™ï¼Œå‰ç«¯åº“åœ¨æ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä¸è¿›è¡Œbundleï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¿ç•™æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œå¼•å…¥çš„æ—¶å€™ä¹Ÿéœ€è¦æŒ‰ç…§æ–‡ä»¶ç›®å½•å¼•å…¥ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡â€œæ–‡ä»¶éš”ç¦»â€æ¥è¾¾åˆ°é™æ€æ€§ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šå¼•å…¥çš„è·¯å¾„ä¼šéå¸¸é•¿ï¼Œå¢åŠ äº†å­¦ä¹ æˆæœ¬ï¼Œä¸å¤Ÿä¼˜é›…ã€‚\nimport { Button } from \u0026#39;antd\/lib\/button\u0026#39; import { Table } from \u0026#39;antd\/lib\/table\u0026#39; æ‰€ä»¥åæ¥å‰ç«¯åº“åœ¨æŒ‰éœ€å¼•å…¥æ—¶ä¼šåŒæ—¶æä¾›ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒä¼šå¸®ä½ è‡ªåŠ¨åŒ¹é…æ–‡ä»¶ç›®å½•ï¼Œç„¶åå¼•å…¥ã€‚æ˜¾è€Œæ˜“è§è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šéœ€è¦åœ¨é¡¹ç›®ä¸­é…ç½®é¢å¤–çš„æ’ä»¶ã€‚\nimport { Button } from \u0026#39;antd\u0026#39; \/\/ é€šè¿‡æ’ä»¶è‡ªåŠ¨è½¬æ¢æˆğŸ‘‡ var Button = require(\u0026#39;antd\/lib\/button\u0026#39;)  ä¸ç®¡é…ç½®æ’ä»¶æœ‰å¤šç®€å•ï¼Œåªè¦å¤šä¸€ä¸ªæ­¥éª¤ï¼Œæ€»ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œç»™å¼€å‘è€…å¢åŠ å­¦ä¹ æˆæœ¬ã€‚\n å¯ä»¥æ‰“å¼€ https:\/\/github.com\/umijs\/babel-plugin-import çœ‹çœ‹ï¼Œç›¸ä¿¡ä½ ä¹Ÿæ— æ³•åœ¨10åˆ†é’Ÿå†…çœ‹æ‡‚å®ƒçš„ç”¨æ³•å¹¶æˆåŠŸè·‘èµ·æ¥ï¼Œè¿™å°±æ˜¯å¤šä½™çš„å­¦ä¹ æˆæœ¬ã€‚\nåœ¨ESMæ—¶ä»£ï¼Œä¹ŸåŒæ—¶è¿›å…¥äº†tree-shakingçš„æ—¶ä»£ å¥½åœ¨æœ‰ESMçš„å¤©ç„¶é™æ€ä¼˜åŠ¿åŠ æŒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ—¢bundleï¼Œåˆä¿ç•™tree-shakingçš„èƒ½åŠ›ã€‚è¿™ä¸€åˆ‡å¯¹äºä½¿ç”¨åº“çš„å¼€å‘è€…æ¥è¯´ï¼Œéƒ½æ˜¯è‡ªåŠ¨å®ç°çš„ï¼Œæ²¡æœ‰é¢å¤–çš„å­¦ä¹ æˆæœ¬ã€‚\nRollupå®˜ç½‘ç¤ºä¾‹ï¼štree-shaking\nâš ï¸æ³¨æ„äº‹é¡¹ tree-shakingçš„ç²’åº¦ï¼Œä»¥è¢«exportçš„èµ„æºä¸ºå•ä½ã€‚\nåœ¨å¼€å‘ä½ çš„åº“æ—¶ï¼Œä½ éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\n1. æ³¨æ„å‡½æ•°çš„å‰¯ä½œç”¨ \/\/ utils.js  export const zero = 0 export const getValue = (a) =\u0026gt; { return a.value } \/\/ è¿™é‡Œæœ‰å‰¯ä½œç”¨ export const five = getValue({value: 5}) å°±ç®—æ²¡æœ‰å¼•å…¥fiveï¼Œä½†æ˜¯getValueå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œè¿™å°±æ˜¯å‰¯ä½œç”¨ã€‚ä¸ºäº†ä¿è¯shakeåçš„ç»“æœ\/è¡Œä¸ºä¸€è‡´ï¼Œå°±å¿…é¡»è¦ä¿ç•™è¿™æ®µä»£ç å‡½æ•°ã€‚","inLanguage":"en-US","author":"VAANOTE","creator":"VAANOTE","publisher":"VAANOTE","accountablePerson":"VAANOTE","copyrightHolder":"VAANOTE","copyrightYear":"2022","datePublished":"2022-09-15 21:15:58 \u002b0800 \u002b0800","dateModified":"2022-09-15 21:15:58 \u002b0800 \u002b0800","url":"https:\/\/note.vaakian.com\/frontend\/tree-shaking\/","keywords":[]}</script>
<title>å…³äº tree-shaking</title>
<meta property="og:title" content="å…³äº tree-shaking">
<meta property="og:type" content="article">
<meta property="og:description" content="æœ€è¿‘å¯¹Tree-shakingåšäº†ä¸å°‘çš„äº†è§£å’Œç ”ç©¶ï¼Œè¿™é‡Œåšä¸€äº›ä¸ªäººæ€»ç»“ï¼Œæ–¹ä¾¿ä»¥åé—å¿˜æ—¶è¿›è¡Œå¤ä¹ ã€‚
ä»€ä¹ˆæ˜¯Tree-shaking æœ¯è¯­è§£é‡Š Tree-shakingæ˜¯ä¸€ç§ç”¨äºæ¶ˆé™¤JavaScriptä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç (dead-code)çš„ä¼˜åŒ–æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§åŸºäºES6æ¨¡å—çš„é™æ€ä»£ç åˆ†ææŠ€æœ¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±è¿›è¡Œä»£ç çš„æ¶ˆé™¤ï¼Œä»è€Œå‡å°‘ä»£ç ä½“ç§¯ã€‚
é€šä¿—è§£é‡Š ä»è‹±æ–‡å­—é¢æ„æ€â€œæ‘‡æ ‘â€ä¸Šæ¥çœ‹ï¼Œå°±æ˜¯æŠŠä¸€æ£µæ ‘ä¸Šçš„ä¸éœ€è¦çš„å¶å­æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„å¶å­ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒTree-shakingå°±æ˜¯æŒ‡åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼ŒæŠŠä¸éœ€è¦çš„ä»£ç æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„ä»£ç ã€‚
Tree-shakingçš„åŸç† æ—©æœŸå¤§éƒ¨åˆ†nodeåŒ…éƒ½æ˜¯commonJSæ ¼å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡requireæ¥å¼•å…¥ã€‚å®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šå› ä¸ºå®ƒçš„åŠ¨æ€æ€§ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¾ˆéš¾æ‰¾åˆ°ä¸ç”¨çš„ä»£ç è¿›è¡Œtree-shakingã€‚
åˆ°äº†ESModuleæ—¶ä»£ï¼ŒTree-shakingå˜å¾—å®¹æ˜“èµ·æ¥ã€‚
æœ€æ—©çš„Tree-shakingæ˜¯ç”±Rollup.jsæå‡ºçš„ï¼Œå®ƒçš„å°±æ˜¯åˆ©ç”¨ESMçš„é™æ€ä¼˜åŠ¿ï¼Œé€šè¿‡é™æ€åˆ†ææ‰¾å‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ç„¶åæŠŠæ²¡æœ‰ç”¨åˆ°çš„ä»£ç å»æ‰ã€‚
é‚£ä¹ˆæ—©æœŸæ²¡æœ‰ESMï¼Œtree-shakingæŠ€æœ¯çš„æ—¶å€™ï¼Œæ€ä¹ˆåšåˆ°æŒ‰éœ€æ‰“åŒ…ï¼Ÿ åœ¨Tree-shakingæ²¡æœ‰å…´èµ·çš„æ—¶å€™ï¼Œå‰ç«¯åº“åœ¨æ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä¸è¿›è¡Œbundleï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¿ç•™æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œå¼•å…¥çš„æ—¶å€™ä¹Ÿéœ€è¦æŒ‰ç…§æ–‡ä»¶ç›®å½•å¼•å…¥ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡â€œæ–‡ä»¶éš”ç¦»â€æ¥è¾¾åˆ°é™æ€æ€§ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šå¼•å…¥çš„è·¯å¾„ä¼šéå¸¸é•¿ï¼Œå¢åŠ äº†å­¦ä¹ æˆæœ¬ï¼Œä¸å¤Ÿä¼˜é›…ã€‚
import { Button } from &amp;#39;antd/lib/button&amp;#39; import { Table } from &amp;#39;antd/lib/table&amp;#39; æ‰€ä»¥åæ¥å‰ç«¯åº“åœ¨æŒ‰éœ€å¼•å…¥æ—¶ä¼šåŒæ—¶æä¾›ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒä¼šå¸®ä½ è‡ªåŠ¨åŒ¹é…æ–‡ä»¶ç›®å½•ï¼Œç„¶åå¼•å…¥ã€‚æ˜¾è€Œæ˜“è§è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šéœ€è¦åœ¨é¡¹ç›®ä¸­é…ç½®é¢å¤–çš„æ’ä»¶ã€‚
import { Button } from &amp;#39;antd&amp;#39; // é€šè¿‡æ’ä»¶è‡ªåŠ¨è½¬æ¢æˆğŸ‘‡ var Button = require(&amp;#39;antd/lib/button&amp;#39;)  ä¸ç®¡é…ç½®æ’ä»¶æœ‰å¤šç®€å•ï¼Œåªè¦å¤šä¸€ä¸ªæ­¥éª¤ï¼Œæ€»ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œç»™å¼€å‘è€…å¢åŠ å­¦ä¹ æˆæœ¬ã€‚
 å¯ä»¥æ‰“å¼€ https://github.com/umijs/babel-plugin-import çœ‹çœ‹ï¼Œç›¸ä¿¡ä½ ä¹Ÿæ— æ³•åœ¨10åˆ†é’Ÿå†…çœ‹æ‡‚å®ƒçš„ç”¨æ³•å¹¶æˆåŠŸè·‘èµ·æ¥ï¼Œè¿™å°±æ˜¯å¤šä½™çš„å­¦ä¹ æˆæœ¬ã€‚
åœ¨ESMæ—¶ä»£ï¼Œä¹ŸåŒæ—¶è¿›å…¥äº†tree-shakingçš„æ—¶ä»£ å¥½åœ¨æœ‰ESMçš„å¤©ç„¶é™æ€ä¼˜åŠ¿åŠ æŒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ—¢bundleï¼Œåˆä¿ç•™tree-shakingçš„èƒ½åŠ›ã€‚è¿™ä¸€åˆ‡å¯¹äºä½¿ç”¨åº“çš„å¼€å‘è€…æ¥è¯´ï¼Œéƒ½æ˜¯è‡ªåŠ¨å®ç°çš„ï¼Œæ²¡æœ‰é¢å¤–çš„å­¦ä¹ æˆæœ¬ã€‚
Rollupå®˜ç½‘ç¤ºä¾‹ï¼štree-shaking
âš ï¸æ³¨æ„äº‹é¡¹ tree-shakingçš„ç²’åº¦ï¼Œä»¥è¢«exportçš„èµ„æºä¸ºå•ä½ã€‚
åœ¨å¼€å‘ä½ çš„åº“æ—¶ï¼Œä½ éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ³¨æ„å‡½æ•°çš„å‰¯ä½œç”¨ // utils.js  export const zero = 0 export const getValue = (a) =&amp;gt; { return a.value } // è¿™é‡Œæœ‰å‰¯ä½œç”¨ export const five = getValue({value: 5}) å°±ç®—æ²¡æœ‰å¼•å…¥fiveï¼Œä½†æ˜¯getValueå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œè¿™å°±æ˜¯å‰¯ä½œç”¨ã€‚ä¸ºäº†ä¿è¯shakeåçš„ç»“æœ/è¡Œä¸ºä¸€è‡´ï¼Œå°±å¿…é¡»è¦ä¿ç•™è¿™æ®µä»£ç å‡½æ•°ã€‚">
<meta name=description content="æœ€è¿‘å¯¹Tree-shakingåšäº†ä¸å°‘çš„äº†è§£å’Œç ”ç©¶ï¼Œè¿™é‡Œåšä¸€äº›ä¸ªäººæ€»ç»“ï¼Œæ–¹ä¾¿ä»¥åé—å¿˜æ—¶è¿›è¡Œå¤ä¹ ã€‚
ä»€ä¹ˆæ˜¯Tree-shaking æœ¯è¯­è§£é‡Š Tree-shakingæ˜¯ä¸€ç§ç”¨äºæ¶ˆé™¤JavaScriptä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç (dead-code)çš„ä¼˜åŒ–æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§åŸºäºES6æ¨¡å—çš„é™æ€ä»£ç åˆ†ææŠ€æœ¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±è¿›è¡Œä»£ç çš„æ¶ˆé™¤ï¼Œä»è€Œå‡å°‘ä»£ç ä½“ç§¯ã€‚
é€šä¿—è§£é‡Š ä»è‹±æ–‡å­—é¢æ„æ€â€œæ‘‡æ ‘â€ä¸Šæ¥çœ‹ï¼Œå°±æ˜¯æŠŠä¸€æ£µæ ‘ä¸Šçš„ä¸éœ€è¦çš„å¶å­æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„å¶å­ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒTree-shakingå°±æ˜¯æŒ‡åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼ŒæŠŠä¸éœ€è¦çš„ä»£ç æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„ä»£ç ã€‚
Tree-shakingçš„åŸç† æ—©æœŸå¤§éƒ¨åˆ†nodeåŒ…éƒ½æ˜¯commonJSæ ¼å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡requireæ¥å¼•å…¥ã€‚å®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šå› ä¸ºå®ƒçš„åŠ¨æ€æ€§ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¾ˆéš¾æ‰¾åˆ°ä¸ç”¨çš„ä»£ç è¿›è¡Œtree-shakingã€‚
åˆ°äº†ESModuleæ—¶ä»£ï¼ŒTree-shakingå˜å¾—å®¹æ˜“èµ·æ¥ã€‚
æœ€æ—©çš„Tree-shakingæ˜¯ç”±Rollup.jsæå‡ºçš„ï¼Œå®ƒçš„å°±æ˜¯åˆ©ç”¨ESMçš„é™æ€ä¼˜åŠ¿ï¼Œé€šè¿‡é™æ€åˆ†ææ‰¾å‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ç„¶åæŠŠæ²¡æœ‰ç”¨åˆ°çš„ä»£ç å»æ‰ã€‚
é‚£ä¹ˆæ—©æœŸæ²¡æœ‰ESMï¼Œtree-shakingæŠ€æœ¯çš„æ—¶å€™ï¼Œæ€ä¹ˆåšåˆ°æŒ‰éœ€æ‰“åŒ…ï¼Ÿ åœ¨Tree-shakingæ²¡æœ‰å…´èµ·çš„æ—¶å€™ï¼Œå‰ç«¯åº“åœ¨æ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä¸è¿›è¡Œbundleï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¿ç•™æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œå¼•å…¥çš„æ—¶å€™ä¹Ÿéœ€è¦æŒ‰ç…§æ–‡ä»¶ç›®å½•å¼•å…¥ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡â€œæ–‡ä»¶éš”ç¦»â€æ¥è¾¾åˆ°é™æ€æ€§ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šå¼•å…¥çš„è·¯å¾„ä¼šéå¸¸é•¿ï¼Œå¢åŠ äº†å­¦ä¹ æˆæœ¬ï¼Œä¸å¤Ÿä¼˜é›…ã€‚
import { Button } from &amp;#39;antd/lib/button&amp;#39; import { Table } from &amp;#39;antd/lib/table&amp;#39; æ‰€ä»¥åæ¥å‰ç«¯åº“åœ¨æŒ‰éœ€å¼•å…¥æ—¶ä¼šåŒæ—¶æä¾›ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒä¼šå¸®ä½ è‡ªåŠ¨åŒ¹é…æ–‡ä»¶ç›®å½•ï¼Œç„¶åå¼•å…¥ã€‚æ˜¾è€Œæ˜“è§è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šéœ€è¦åœ¨é¡¹ç›®ä¸­é…ç½®é¢å¤–çš„æ’ä»¶ã€‚
import { Button } from &amp;#39;antd&amp;#39; // é€šè¿‡æ’ä»¶è‡ªåŠ¨è½¬æ¢æˆğŸ‘‡ var Button = require(&amp;#39;antd/lib/button&amp;#39;)  ä¸ç®¡é…ç½®æ’ä»¶æœ‰å¤šç®€å•ï¼Œåªè¦å¤šä¸€ä¸ªæ­¥éª¤ï¼Œæ€»ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œç»™å¼€å‘è€…å¢åŠ å­¦ä¹ æˆæœ¬ã€‚
 å¯ä»¥æ‰“å¼€ https://github.com/umijs/babel-plugin-import çœ‹çœ‹ï¼Œç›¸ä¿¡ä½ ä¹Ÿæ— æ³•åœ¨10åˆ†é’Ÿå†…çœ‹æ‡‚å®ƒçš„ç”¨æ³•å¹¶æˆåŠŸè·‘èµ·æ¥ï¼Œè¿™å°±æ˜¯å¤šä½™çš„å­¦ä¹ æˆæœ¬ã€‚
åœ¨ESMæ—¶ä»£ï¼Œä¹ŸåŒæ—¶è¿›å…¥äº†tree-shakingçš„æ—¶ä»£ å¥½åœ¨æœ‰ESMçš„å¤©ç„¶é™æ€ä¼˜åŠ¿åŠ æŒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ—¢bundleï¼Œåˆä¿ç•™tree-shakingçš„èƒ½åŠ›ã€‚è¿™ä¸€åˆ‡å¯¹äºä½¿ç”¨åº“çš„å¼€å‘è€…æ¥è¯´ï¼Œéƒ½æ˜¯è‡ªåŠ¨å®ç°çš„ï¼Œæ²¡æœ‰é¢å¤–çš„å­¦ä¹ æˆæœ¬ã€‚
Rollupå®˜ç½‘ç¤ºä¾‹ï¼štree-shaking
âš ï¸æ³¨æ„äº‹é¡¹ tree-shakingçš„ç²’åº¦ï¼Œä»¥è¢«exportçš„èµ„æºä¸ºå•ä½ã€‚
åœ¨å¼€å‘ä½ çš„åº“æ—¶ï¼Œä½ éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ³¨æ„å‡½æ•°çš„å‰¯ä½œç”¨ // utils.js  export const zero = 0 export const getValue = (a) =&amp;gt; { return a.value } // è¿™é‡Œæœ‰å‰¯ä½œç”¨ export const five = getValue({value: 5}) å°±ç®—æ²¡æœ‰å¼•å…¥fiveï¼Œä½†æ˜¯getValueå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œè¿™å°±æ˜¯å‰¯ä½œç”¨ã€‚ä¸ºäº†ä¿è¯shakeåçš„ç»“æœ/è¡Œä¸ºä¸€è‡´ï¼Œå°±å¿…é¡»è¦ä¿ç•™è¿™æ®µä»£ç å‡½æ•°ã€‚">
<meta property="og:locale" content="en-us">
<style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px;font-family:inherit}.markdown-body pre>code{padding:0;font-size:100%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:bungee shade,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center;display:flex;justify-content:right}.posts-category{padding:3px 8px;border:#000 2px solid;border-radius:5px;margin-left:3px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{text-align:center}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}}@media screen and (max-width:48em){.posts-category{display:none}}blockquote{background-color:#f6fbff;border-left:3px solid lightgrey;padding-left:5px;margin-inline:0;color:#555}</style>
<style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
<link href=/index.xml rel=alternate type=application/rss+xml title="Study Notes">
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.font.im/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet>
</head>
<body>
<article class=post id=article>
<div class=row>
<div class=col-xs-12>
<div class=site-header>
<header>
<div class=header-title>
<a href=/>VAANOTE</a>
</div>
<div class=header-subtitle>Godless</div>
</header>
<div class="row end-md center-xs header-items">
<div class=header-item>
<a href=/index.xml target=_blank>RSS</a>
</div>
<div class=header-item>
<a href=/about target=_blank>About</a>
</div>
</div>
<div class="row end-xs">
</div>
<div class=header-line></div>
</div>
<header class=post-header>
<h1 class=post-title>å…³äº tree-shaking</h1>
<div class="row post-desc">
<div class=col-xs-6>
<time class=post-date datetime="2022-09-15 21:15:58 +0800">
15 Sep 2022
</time>
</div>
<div class=col-xs-6>
<div class=post-author>
<a target=_blank href=https://notes.vaakian.com/>@VAANOTE</a>
</div>
</div>
</div>
</header>
<div class="post-content markdown-body">
<p>æœ€è¿‘å¯¹Tree-shakingåšäº†ä¸å°‘çš„äº†è§£å’Œç ”ç©¶ï¼Œè¿™é‡Œåšä¸€äº›ä¸ªäººæ€»ç»“ï¼Œæ–¹ä¾¿ä»¥åé—å¿˜æ—¶è¿›è¡Œå¤ä¹ ã€‚</p>
<h2 id=ä»€ä¹ˆæ˜¯tree-shaking>ä»€ä¹ˆæ˜¯Tree-shaking</h2>
<h3 id=æœ¯è¯­è§£é‡Š>æœ¯è¯­è§£é‡Š</h3>
<p>Tree-shakingæ˜¯ä¸€ç§ç”¨äºæ¶ˆé™¤JavaScriptä¸Šä¸‹æ–‡ä¸­çš„æœªå¼•ç”¨ä»£ç (dead-code)çš„ä¼˜åŒ–æŠ€æœ¯ã€‚å®ƒæ˜¯ä¸€ç§åŸºäºES6æ¨¡å—çš„é™æ€ä»£ç åˆ†ææŠ€æœ¯ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶å°±è¿›è¡Œä»£ç çš„æ¶ˆé™¤ï¼Œä»è€Œå‡å°‘ä»£ç ä½“ç§¯ã€‚</p>
<h3 id=é€šä¿—è§£é‡Š>é€šä¿—è§£é‡Š</h3>
<p>ä»è‹±æ–‡å­—é¢æ„æ€â€œæ‘‡æ ‘â€ä¸Šæ¥çœ‹ï¼Œå°±æ˜¯æŠŠä¸€æ£µæ ‘ä¸Šçš„ä¸éœ€è¦çš„å¶å­æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„å¶å­ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒTree-shakingå°±æ˜¯æŒ‡åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼ŒæŠŠä¸éœ€è¦çš„ä»£ç æ‘‡ä¸‹æ¥ï¼Œåªä¿ç•™éœ€è¦çš„ä»£ç ã€‚</p>
<h2 id=tree-shakingçš„åŸç†>Tree-shakingçš„åŸç†</h2>
<p>æ—©æœŸå¤§éƒ¨åˆ†nodeåŒ…éƒ½æ˜¯commonJSæ ¼å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡requireæ¥å¼•å…¥ã€‚å®ƒæœ‰ä¸€ä¸ªè‡´å‘½çš„ç¼ºé™·ï¼šå› ä¸ºå®ƒçš„åŠ¨æ€æ€§ï¼Œæ— æ³•åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¾ˆéš¾æ‰¾åˆ°ä¸ç”¨çš„ä»£ç è¿›è¡Œtree-shakingã€‚</p>
<p>åˆ°äº†ESModuleæ—¶ä»£ï¼ŒTree-shakingå˜å¾—å®¹æ˜“èµ·æ¥ã€‚<br>
æœ€æ—©çš„Tree-shakingæ˜¯ç”±Rollup.jsæå‡ºçš„ï¼Œå®ƒçš„å°±æ˜¯åˆ©ç”¨ESMçš„é™æ€ä¼˜åŠ¿ï¼Œé€šè¿‡é™æ€åˆ†ææ‰¾å‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ç„¶åæŠŠæ²¡æœ‰ç”¨åˆ°çš„ä»£ç å»æ‰ã€‚</p>
<h2 id=é‚£ä¹ˆæ—©æœŸæ²¡æœ‰esmtree-shakingæŠ€æœ¯çš„æ—¶å€™æ€ä¹ˆåšåˆ°æŒ‰éœ€æ‰“åŒ…>é‚£ä¹ˆæ—©æœŸæ²¡æœ‰ESMï¼Œtree-shakingæŠ€æœ¯çš„æ—¶å€™ï¼Œæ€ä¹ˆåšåˆ°æŒ‰éœ€æ‰“åŒ…ï¼Ÿ</h2>
<p>åœ¨Tree-shakingæ²¡æœ‰å…´èµ·çš„æ—¶å€™ï¼Œå‰ç«¯åº“åœ¨æ‰“åŒ…çš„æ—¶å€™å¯ä»¥ä¸è¿›è¡Œbundleï¼Œæ¯ä¸ªç»„ä»¶éƒ½ä¿ç•™æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œå¼•å…¥çš„æ—¶å€™ä¹Ÿéœ€è¦æŒ‰ç…§æ–‡ä»¶ç›®å½•å¼•å…¥ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡â€œæ–‡ä»¶éš”ç¦»â€æ¥è¾¾åˆ°é™æ€æ€§ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šå¼•å…¥çš„è·¯å¾„ä¼šéå¸¸é•¿ï¼Œå¢åŠ äº†å­¦ä¹ æˆæœ¬ï¼Œä¸å¤Ÿä¼˜é›…ã€‚</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Button</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#39;antd/lib/button&#39;</span>
<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Table</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#39;antd/lib/table&#39;</span>
</code></pre></div><p>æ‰€ä»¥åæ¥å‰ç«¯åº“åœ¨æŒ‰éœ€å¼•å…¥æ—¶ä¼šåŒæ—¶æä¾›ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒä¼šå¸®ä½ è‡ªåŠ¨åŒ¹é…æ–‡ä»¶ç›®å½•ï¼Œç„¶åå¼•å…¥ã€‚æ˜¾è€Œæ˜“è§è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼šéœ€è¦åœ¨é¡¹ç›®ä¸­é…ç½®é¢å¤–çš„æ’ä»¶ã€‚</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Button</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#39;antd&#39;</span>
<span style=color:#8f5902;font-style:italic>// é€šè¿‡æ’ä»¶è‡ªåŠ¨è½¬æ¢æˆğŸ‘‡
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>Button</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;antd/lib/button&#39;</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><blockquote>
<p>ä¸ç®¡é…ç½®æ’ä»¶æœ‰å¤šç®€å•ï¼Œåªè¦å¤šä¸€ä¸ªæ­¥éª¤ï¼Œæ€»ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œç»™å¼€å‘è€…å¢åŠ å­¦ä¹ æˆæœ¬ã€‚</p>
</blockquote>
<p>å¯ä»¥æ‰“å¼€ <a href=https://github.com/umijs/babel-plugin-import>https://github.com/umijs/babel-plugin-import</a> çœ‹çœ‹ï¼Œç›¸ä¿¡ä½ ä¹Ÿæ— æ³•åœ¨10åˆ†é’Ÿå†…çœ‹æ‡‚å®ƒçš„ç”¨æ³•å¹¶æˆåŠŸè·‘èµ·æ¥ï¼Œè¿™å°±æ˜¯å¤šä½™çš„å­¦ä¹ æˆæœ¬ã€‚</p>
<h2 id=åœ¨esmæ—¶ä»£ä¹ŸåŒæ—¶è¿›å…¥äº†tree-shakingçš„æ—¶ä»£>åœ¨ESMæ—¶ä»£ï¼Œä¹ŸåŒæ—¶è¿›å…¥äº†tree-shakingçš„æ—¶ä»£</h2>
<p>å¥½åœ¨æœ‰ESMçš„å¤©ç„¶é™æ€ä¼˜åŠ¿åŠ æŒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ—¢bundleï¼Œåˆä¿ç•™tree-shakingçš„èƒ½åŠ›ã€‚è¿™ä¸€åˆ‡å¯¹äºä½¿ç”¨åº“çš„å¼€å‘è€…æ¥è¯´ï¼Œéƒ½æ˜¯è‡ªåŠ¨å®ç°çš„ï¼Œæ²¡æœ‰é¢å¤–çš„å­¦ä¹ æˆæœ¬ã€‚</p>
<p><a href="https://rollupjs.org/repl/?version=2.79.1&shareable=JTdCJTIybW9kdWxlcyUyMiUzQSU1QiU3QiUyMm5hbWUlMjIlM0ElMjJtYWluLmpzJTIyJTJDJTIyY29kZSUyMiUzQSUyMiUyRiolMjBUUkVFLVNIQUtJTkclMjAqJTJGJTVDbmltcG9ydCUyMCU3QiUyMGN1YmUlMjAlN0QlMjBmcm9tJTIwJy4lMkZtYXRocy5qcyclM0IlNUNuJTVDbmNvbnNvbGUubG9nKCUyMGN1YmUoJTIwNSUyMCklMjApJTNCJTIwJTJGJTJGJTIwMTI1JTIyJTJDJTIyaXNFbnRyeSUyMiUzQXRydWUlN0QlMkMlN0IlMjJuYW1lJTIyJTNBJTIybWF0aHMuanMlMjIlMkMlMjJjb2RlJTIyJTNBJTIyJTJGJTJGJTIwbWF0aHMuanMlNUNuJTVDbiUyRiUyRiUyMFRoaXMlMjBmdW5jdGlvbiUyMGlzbid0JTIwdXNlZCUyMGFueXdoZXJlJTJDJTIwc28lNUNuJTJGJTJGJTIwUm9sbHVwJTIwZXhjbHVkZXMlMjBpdCUyMGZyb20lMjB0aGUlMjBidW5kbGUuLi4lNUNuZXhwb3J0JTIwZnVuY3Rpb24lMjBzcXVhcmUlMjAoJTIweCUyMCklMjAlN0IlNUNuJTVDdHJldHVybiUyMHglMjAqJTIweCUzQiU1Q24lN0QlNUNuJTVDbiUyRiUyRiUyMFRoaXMlMjBmdW5jdGlvbiUyMGdldHMlMjBpbmNsdWRlZCU1Q25leHBvcnQlMjBmdW5jdGlvbiUyMGN1YmUlMjAoJTIweCUyMCklMjAlN0IlNUNuJTVDdCUyRiUyRiUyMHJld3JpdGUlMjB0aGlzJTIwYXMlMjAlNjBzcXVhcmUoJTIweCUyMCklMjAqJTIweCU2MCU1Q24lNUN0JTJGJTJGJTIwYW5kJTIwc2VlJTIwd2hhdCUyMGhhcHBlbnMhJTVDbiU1Q3RyZXR1cm4lMjB4JTIwKiUyMHglMjAqJTIweCUzQiU1Q24lN0QlMjIlMkMlMjJpc0VudHJ5JTIyJTNBZmFsc2UlN0QlNUQlMkMlMjJvcHRpb25zJTIyJTNBJTdCJTIyZm9ybWF0JTIyJTNBJTIyZXMlMjIlMkMlMjJuYW1lJTIyJTNBJTIybXlCdW5kbGUlMjIlMkMlMjJhbWQlMjIlM0ElN0IlMjJpZCUyMiUzQSUyMiUyMiU3RCUyQyUyMmdsb2JhbHMlMjIlM0ElN0IlN0QlN0QlMkMlMjJleGFtcGxlJTIyJTNBJTIyMDIlMjIlN0Q=">Rollupå®˜ç½‘ç¤ºä¾‹ï¼štree-shaking</a></p>
<h2 id=æ³¨æ„äº‹é¡¹>âš ï¸æ³¨æ„äº‹é¡¹</h2>
<p>tree-shakingçš„ç²’åº¦ï¼Œä»¥è¢«exportçš„èµ„æºä¸ºå•ä½ã€‚<br>
åœ¨å¼€å‘ä½ çš„åº“æ—¶ï¼Œä½ éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<h3 id=1-æ³¨æ„å‡½æ•°çš„å‰¯ä½œç”¨>1. æ³¨æ„å‡½æ•°çš„å‰¯ä½œç”¨</h3>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#8f5902;font-style:italic>// utils.js
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>zero</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>

<span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>getValue</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>a</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>value</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic>// è¿™é‡Œæœ‰å‰¯ä½œç”¨
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>five</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>getValue</span><span style=color:#000;font-weight:700>({</span><span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>})</span>
</code></pre></div><p>å°±ç®—æ²¡æœ‰å¼•å…¥fiveï¼Œä½†æ˜¯getValueå‡½æ•°ä¼šè¢«æ‰§è¡Œï¼Œè¿™å°±æ˜¯å‰¯ä½œç”¨ã€‚ä¸ºäº†ä¿è¯shakeåçš„ç»“æœ/è¡Œä¸ºä¸€è‡´ï¼Œå°±å¿…é¡»è¦ä¿ç•™è¿™æ®µä»£ç å‡½æ•°ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¿™ä¸ªå‡½æ•°å¯èƒ½ä¼šæœ‰å‰¯ä½œç”¨ï¼Œæ¯”å¦‚è¯´ä¿®æ”¹å…¨å±€å˜é‡ï¼Œæˆ–è€…æ˜¯ä¿®æ”¹DOMï¼Œæˆ–è€…æ˜¯å‘é€ç½‘ç»œè¯·æ±‚ç­‰ç­‰ã€‚ç„¶åå…¶å®ƒåœ°æ–¹çš„ä»£ç å¯èƒ½ä¼šä¾èµ–è¿™äº›è¢«ä¿®æ”¹çš„æ•°æ®ã€‚</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#8f5902;font-style:italic>// main.js
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>zero</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>from</span> <span style=color:#4e9a06>&#39;./utils&#39;</span>

<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>zero</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p>æ‰€ä»¥æœ€åçš„äº§ç‰©è¾“å‡ºä¸ºï¼š</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>zero</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>

<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>getValue</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>a</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>value</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>getValue</span><span style=color:#000;font-weight:700>({</span><span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>})</span>

<span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>zero</span><span style=color:#000;font-weight:700>)</span>
</code></pre></div><p><img src=/images/20220924181410.png alt></p>
<p>è¦é¿å…è¿™ç§æƒ…å†µï¼Œå°±éœ€è¦å‘Šè¯‰bundlerï¼Œè¿™ä¸ªå‡½æ•°æ²¡æœ‰å‰¯ä½œç”¨ã€‚ç›®å‰æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š</p>
<h4 id=11-pacakgejsonä¸­çš„-sideeffectså±æ€§>1.1 pacakge.jsonä¸­çš„ <code>sideEffects</code>å±æ€§</h4>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=color:#8f5902;font-style:italic>// pacakge.json
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>&#34;name&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;myPkg&#34;</span><span style=color:#000;font-weight:700>,</span>
  <span style=color:#204a87;font-weight:700>&#34;sideEffects&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>false</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p><a href=https://webpack.js.org/guides/tree-shaking/#mark-the-file-as-side-effect-free>https://webpack.js.org/guides/tree-shaking/#mark-the-file-as-side-effect-free</a></p>
<p>è¿™ç§æ–¹å¼æœ€æ—©ç”±webpackæå‡ºï¼Œä½†æ˜¯åæ¥è¢«rollupä¹Ÿæ”¯æŒäº†ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯ç®€å•ï¼Œç¼ºç‚¹æ˜¯ç²’åº¦å¤ªç²—ï¼Œåªèƒ½é’ˆå¯¹æ•´ä¸ªåŒ…è¿›è¡Œè®¾ç½®ã€‚å¦‚æœä½ çš„åŒ…ä¸­æœ‰ä¸€äº›å‡½æ•°æ˜¯æœ‰å‰¯ä½œç”¨çš„ï¼Œè€Œå¦ä¸€äº›å‡½æ•°æ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„ï¼Œé‚£å°±è¦ç”¨åˆ°ç¬¬äºŒç§æ–¹æ³•ã€‚</p>
<h4 id=12-é­”æ³•æ³¨é‡Šmagic-comment>1.2 é­”æ³•æ³¨é‡Šï¼ˆmagic commentï¼‰</h4>
<p>é€šè¿‡ <code>/*#__PURE__*/</code> æ³¨é‡Šå‘Šè¯‰bundlerï¼Œè¿™ä¸ªå‡½æ•°æ²¡æœ‰å‰¯ä½œç”¨ã€‚</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#8f5902;font-style:italic>// utils.js
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>zero</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
<span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>getValue</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>a</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>a</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>value</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>five</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#8f5902;font-style:italic>/* #__PURE__ */</span> <span style=color:#000>getValue</span><span style=color:#000;font-weight:700>({</span><span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>})</span>
</code></pre></div><p><img src=/images/20220924182201.png alt></p>
<h3 id=2-ä¸è¦ç”¨å¯¹è±¡æˆ–è€…classç­‰ç­‰ä»»ä½•åŠ¨æ€å˜é‡æ¥å°è£…æ¨¡å—>2. ä¸è¦ç”¨ã€Œå¯¹è±¡ã€æˆ–è€…ã€ŒClassã€ç­‰ç­‰ä»»ä½•åŠ¨æ€å˜é‡æ¥å°è£…æ¨¡å—</h3>
<p>å°†æ‰€æœ‰ä½ è®¤ä¸ºéœ€è¦æŒ‰éœ€çš„èµ„æºï¼Œéƒ½é€šè¿‡exportæš´éœ²å‡ºæ¥ã€‚ä¸€å®šä¸è¦ç”¨å¯¹è±¡æˆ–è€…Classç­‰ç­‰ä»»ä½•åŠ¨æ€å˜é‡æ¥å°è£…æ¨¡å—ã€‚å› ä¸ºå‰é¢è¯´è¿‡ï¼Œtree-shakingçš„ç²’åº¦æ˜¯ä»¥è¢«exportçš„èµ„æºä¸ºå•ä½ã€‚</p>
<p><a href="https://rollupjs.org/repl/?version=2.79.1&shareable=JTdCJTIybW9kdWxlcyUyMiUzQSU1QiU3QiUyMm5hbWUlMjIlM0ElMjJtYWluLmpzJTIyJTJDJTIyY29kZSUyMiUzQSUyMmltcG9ydCUyMHRvb2xzJTIwJTIwZnJvbSUyMCcuJTJGdXRpbHMnJTVDbiU1Q25jb25zb2xlLmxvZyh0b29scy5mb28pJTIyJTJDJTIyaXNFbnRyeSUyMiUzQXRydWUlN0QlMkMlN0IlMjJuYW1lJTIyJTNBJTIydXRpbHMuanMlMjIlMkMlMjJjb2RlJTIyJTNBJTIyZXhwb3J0JTIwZGVmYXVsdCUyMGNsYXNzJTIwdG9vbHMlMjAlN0IlNUNuJTIwJTIwc3RhdGljJTIwZm9vKCklMjAlN0IlNUNuJTIwJTIwJTIwJTIwY29uc29sZS5sb2coJ2ZvbycpJTVDbiUyMCUyMCU3RCU1Q24lMjAlMjBzdGF0aWMlMjBiYXIoKSUyMCU3QiU1Q24lMjAlMjAlMjAlMjBjb25zb2xlLmxvZygnYmFyJyklNUNuJTIwJTIwJTdEJTVDbiU3RCUyMiUyQyUyMmlzRW50cnklMjIlM0FmYWxzZSU3RCUyQyU3QiUyMm5hbWUlMjIlM0ElMjJtb2R1bGVfMS5qcyUyMiUyQyUyMmNvZGUlMjIlM0ElMjIlMjIlN0QlNUQlMkMlMjJvcHRpb25zJTIyJTNBJTdCJTIyZm9ybWF0JTIyJTNBJTIyZXMlMjIlMkMlMjJuYW1lJTIyJTNBJTIybXlCdW5kbGUlMjIlMkMlMjJhbWQlMjIlM0ElN0IlMjJpZCUyMiUzQSUyMiUyMiU3RCUyQyUyMmdsb2JhbHMlMjIlM0ElN0IlN0QlN0QlMkMlMjJleGFtcGxlJTIyJTNBbnVsbCU3RA==">æŸ¥çœ‹rollupåœ¨çº¿ç¤ºä¾‹</a></p>
<p><img src=/images/20220924191529.png alt><br>
æ”¹é€ åï¼Œæœªç”¨åˆ°çš„<code>bar</code>å‡½æ•°è¢«æˆåŠŸâ€œshakeâ€æ‰äº†ã€‚
<img src=/images/20220924191449.png alt></p>
<h3 id=3-å¦‚æœäº§ç‰©æ˜¯å•ä¸ªbundleé‚£ä¹ˆæ³¨æ„ä¸è¦å°è£…å­æ¨¡å—å¦åˆ™ä¼šå¤±å»tree-shakingçš„èƒ½åŠ›>3. å¦‚æœäº§ç‰©æ˜¯å•ä¸ªbundleï¼Œé‚£ä¹ˆæ³¨æ„ä¸è¦å°è£…å­æ¨¡å—ï¼Œå¦åˆ™ä¼šå¤±å»tree-shakingçš„èƒ½åŠ›ã€‚</h3>
<p>å› ä¸ºåœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸‹ï¼ŒESMå¹¶æ²¡æœ‰æä¾›é™æ€çš„å¯¼å‡ºå­æ¨¡å—çš„èƒ½åŠ›ã€‚ä¹Ÿå°±æ˜¯å¹¶æ²¡æœ‰æä¾›å¤§æ¦‚ä»¥ä¸‹çš„è¯­æ³•ï¼š</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;foo&#39;</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;bar&#39;</span>

<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>a</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>
<span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>b</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span>

<span style=color:#204a87;font-weight:700>export</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>foo</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>bar</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>as</span> <span style=color:#000>subModule1</span>
<span style=color:#204a87;font-weight:700>export</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>a</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>b</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000>as</span> <span style=color:#000>subModule2</span>
</code></pre></div><p>æ‰€ä»¥æ‰“åŒ…å·¥å…·ï¼ˆrollup/webpackï¼‰åœ¨bundleçš„æ—¶å€™ï¼Œä¼šå°†å­æ¨¡å—å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œç„¶åå†å¯¼å‡ºã€‚è¿™æ ·æ•´ä¸ªå­æ¨¡å—å°±å˜æˆäº†ä¸€ä¸ªè¢«exprotçš„å˜é‡ï¼Œå®ƒçš„shakeç²’åº¦å°±æ˜¯æ•´ä¸ªå­æ¨¡å—ï¼Œè€Œä¸æ˜¯å­æ¨¡å—ä¸­çš„æŸä¸ªå‡½æ•°ã€‚é‚£ä¹ˆå¼€å‘è€…åœ¨ä½¿ç”¨ä½ è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œè‡ªç„¶å°±æ²¡æœ‰äº†æŒ‰éœ€å¼•å…¥çš„èƒ½åŠ›ã€‚</p>
<p><img src=/images/20220924184018.png alt>
å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†outputäº§ç‰©ä½œä¸ºä¸€ä¸ªåŒ…å¼•å…¥ï¼Œæœ€åå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š<br>
æˆ‘ä»¬åªç”¨åˆ°äº†<code>sub1.foo</code>å‡½æ•°ï¼Œè€Œsub1è¢«æ•´ä¸ªæ‰“åŒ…è¿›outputäº§ç‰©äº†ã€‚
<img src=/images/20220924184304.png alt></p>
<h3 id=4-ä»£ç è¢«-bundle--æ‰“åŒ…-çš„æ—¶æœº>4. ä»£ç è¢« <code>bundle</code> / <code>æ‰“åŒ…</code> çš„æ—¶æœº</h3>
<p>åœ¨å½“ä»Šçš„å‰ç«¯å·¥ç¨‹åŒ–ä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç æœ€ç»ˆä¼šè¢«å„ç§loaderã€pluginã€æ‰“åŒ…å·¥å…·ç­‰ç­‰å¤„ç†ï¼Œå°†ä¸€ç±»ä»£ç ç¼–è¯‘è½¬æ¢æˆå¦å¤–ä¸€ç±»ä»£ç ï¼Œæ¯”å¦‚ts => jsï¼Œesm => cjsï¼Œæˆ–è€…æ˜¯é€šè¿‡åšbabelå…¼å®¹ã€‚</p>
<p><img src=/images/20220924185531.png alt></p>
<p>å¦‚ä¸Šå›¾çš„ç¼–è¯‘ç»“æœï¼Œè™½ç„¶æˆ‘ä»¬é€šè¿‡exporté™æ€å¯¼å‡ºäº†ä¸€ä¸ªclassï¼Œä½†æ˜¯åœ¨æœ€ç»ˆçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å‘ç°å®ƒè¢«æ‰“åŒ…æˆäº†ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åå†é€šè¿‡<code>module.exports</code>å¯¼å‡ºã€‚å¹¶ä¸”Animalè¢«ç¼–è¯‘æˆäº†ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œè¿™é‡Œå°±äº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ä¸è¿‡ç›®å‰çš„babelå·²ç»è¶³å¤Ÿå…ˆè¿›ï¼Œå¸®æˆ‘ä»¬æ·»åŠ äº†ä¹‹å‰æåˆ°äº†<code>#__PURE__</code>æ³¨é‡Šã€‚</p>
<p>æ‰€ä»¥æœ€å¥½åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œå°†bundleé˜¶æ®µï¼ˆtree-shakeé˜¶æ®µï¼‰ï¼Œæ”¾åœ¨å½“å‰è¢«è½¬æ¢çš„ä»£ç è¿˜æ˜¯ ESM çš„é˜¶æ®µï¼Œç„¶åæŠŠpolyfillç­‰å…¶å®ƒè½¬æ¢æ“ä½œæ”¾åœ¨ä¹‹åã€‚</p>
<h2 id=å°ç»“>å°ç»“</h2>
<p>Tree-shakingå·²ç»è¢«ç°ä»£çš„rollup/webpackç­‰å…¶å®ƒbundleræ‰€é»˜è®¤æ”¯æŒï¼Œå…¶æ ¸å¿ƒå°±æ˜¯ ESM çš„é™æ€<code>import</code> / <code>export</code>ã€‚
åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¼€å‘è€…åœ¨ç¼–å†™ä»£ç æ—¶åªéœ€è¦æ³¨æ„ç¼–å†™è§„èŒƒï¼Œå°±å·²ç»èƒ½å¤Ÿå¾—åˆ°è‰¯å¥½çš„tree-shakingèƒ½åŠ›äº†ã€‚</p>
</div>
<div class="row middle-xs">
<div class=col-xs-12>
</div>
</div>
<div class=row>
<div class=col-xs-12>
</div>
</div>
<div style=height:50px></div>
<div class=post-comments>
<div id=disqus_thread></div>
<script>window.addEventListener("load",()=>{(function(){var a=document,b=a.createElement("script");b.src="https://vaa-note.disqus.com/embed.js",b.setAttribute("data-timestamp",+new Date),(a.head||a.body).appendChild(b)})()})</script>
<noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
</div>
<div class=site-footer>
</div>
</div>
</div>
</article>
<script></script>
</body>
</html>